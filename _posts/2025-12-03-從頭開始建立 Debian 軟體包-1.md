---
layout: post
title: 從頭開始建立 Debian 軟體包（1/7）
date: 2025-12-03 23:12 +0800
tags:
  - debian
  - packaging
  - course-note
---

> 此文章為 Educative.io 上的課程 Building Debian Packages from the Ground Up  
> 預計筆記將整理成七篇文章分享
{: .prompt-tip }

## Introduction to Debian Packages

### 什麼是 Debian 套件?

- **套件（Package）**：用於安裝軟體的壓縮檔案
  - 包含軟體所需的檔案
  - 包含詮釋資料（meta information）：描述、版本、相依性、衝突等
  - 檔案副檔名為 `.deb`
- **套件家族**：Debian、Ubuntu、Linux Mint、Knoppix 等發行版都使用相同的 Debian 套件格式

### 套件管理器與軟體庫（Package Managers and Repositories）

- **套件管理器的運作流程**：
  - 維護一份軟體庫 URL 清單
  - 每個軟體庫包含詮釋資料和實際套件
  - 當要安裝套件（如 Inkscape）時,會查詢該套件的詮釋資料

- **相依性處理（Dependencies）**：
  - 大多數軟體都有相依性：運作所需的其他程式和函式庫
  - 範例：Inkscape 需要
    - `libxml2`：解析和寫入 XML 檔案
    - `libcairo2`：渲染文字和圖像
    - Python 直譯器：支援外掛程式
  - 套件管理器會遞迴檢查並安裝所有相依套件

### 軟體庫鏡像站（Repository Mirrors）

- **鏡像站的作用**：
  - Debian 官方軟體庫的複製,提供相同內容
  - 分散頻寬需求到多個組織
  - 優點：
    - 選擇鄰近鏡像站可降低延遲、提高傳輸速度
    - 若某鏡像站故障,可輕易切換到其他鏡像站
- **企業內部鏡像**：
  - 節省上行頻寬
  - 降低延遲
  - 基礎設施與外部系統解耦

### 套件清單簽章（Package List Signing）

- **安全性考量**：如何確保從鏡像站下載的套件未被竄改?
- **加密簽章機制**：
  - 軟體庫包含套件清單,列出套件檔案連結和校驗碼（checksum）
  - 套件清單使用 PGP（或 GnuPG）金鑰簽署
  - 每台安裝 Debian 套件的機器都有信任的 PGP 金鑰清單
  - 安裝前會驗證套件清單完整性和校驗碼

> 💡 **重點**：透過加密簽章和校驗碼機制,確保即使透過第三方鏡像站下載,套件也不會被惡意竄改。

## Source Packages and Binary Packages

### 原始碼套件與二進位套件

- **Debian 專案核心理念**：強調自由開源軟體（free and open-software）
- **原始碼套件（Source Packages）支援**
  - 可下載用於建置套件的完整原始碼
  - 包含所有補丁（patches）和打包資訊（packaging information）
  - 使用者可自行安裝建置依賴項（build dependencies）並建置二進位套件（binary package）

### 多架構支援（Architectures）

- **Debian 支援多種電腦架構**
  - `amd64`：AMD64 和 Intel 64 位元 i386 處理器
  - `arm64`：64 位元 ARM
  - `mips`：大端序（big-endian）MIPS
  - 其他多種架構

- **建置流程**
  - 開發者僅需上傳原始碼套件至中央伺服器
  - 建置系統（build system）自動處理所有支援架構的編譯工作
  - 解決開發者無法擁有所有架構硬體的實際問題

- **架構標記**
  - `any`：為所有可用架構建置
  - `all`：適用於所有架構的套件
    - 文件（documentation）
    - 標頭檔（header files）
    - 腳本語言應用程式
    - 不含架構特定檔案
  - 關鍵差異：
    - `any` 套件會針對每個架構建置不同版本
    - `all` 套件不需編譯，在所有架構上皆相同

### 可重現建置（Reproducible Builds）

- **定義**：從原始碼建置的套件與官方建置版本完全一致（byte-for-byte identical）
- **Debian 目標**：致力於實現可重現建置，目前已在大多數套件上成功

> 💡 **重現建置的關鍵**
>
> - Debian 套件包含時間戳記（timestamps）
> - 需使用與原始建置相同的時間戳記
> - 額外資訊儲存在 `*.buildinfo` 檔案中
> - 完整重現需要：原始碼套件 + 建置依賴項 + buildinfo 檔案

### 上游開發者（Upstream Developers）

- **定義**：軟體的原始開發者
- **背景**
  - Debian/Ubuntu 軟體庫中的多數軟體並非專為這些發行版開發
  - 由 Debian 或 Ubuntu 開發者進行打包

- **術語由來：價值流（stream of value creation）**
  1. 上游開發者：創造軟體
  2. 打包者：使軟體可安裝
  3. 終端使用者：使用軟體價值

  從打包者角度，原始開發者位於價值流的上游，故稱為「上游開發者」

## `dpkg`, `apt` and Other Frontend Tools

### dpkg 工具

- **定位**：Debian 的底層（low-level）套件管理工具
- **核心功能**
  - 安裝和移除套件
  - 查詢套件資料庫（如列出已安裝套件）
  - 驗證套件相依性是否已安裝

- **限制**
  - ⚠️ **不會**自動解析相依性（dependency resolution）
  - ⚠️ **不會**下載套件
  - ⚠️ **不提供**便利功能

### 高階套件管理工具

- **`apt-get`**：命令列套件管理工具
  - 搭配 `apt-cache` 搜尋套件資訊
  - 搭配 `apt-file` 搜尋檔案所屬套件

- **`apt`**：`apt-*` 工具的現代整合版本
  - 統一的命令列介面
  - 更友善的使用者體驗
  - 日常使用建議優先選擇

- **`aptitude`**：雙模式工具
  - 支援命令列和文字介面（TUI）
  - 提供更智慧的相依性衝突解決

- **`synaptic`**：圖形化（GUI）套件管理程式
  - 使用 GTK+ 建置
  - 多個發行版的預設圖形管理器
